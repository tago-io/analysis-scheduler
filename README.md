## What this script does
Bring a live demo for your customers and team using Tago instead of showing a Powerpoint file! This application creates data in your Tago account to simulate a device using the content created in a Google Spreadsheet. Tago will transfer the data from each row of your spreadsheet one-by-one to help you to share how your connect product will look like even before you add real hardware (sensors) on it. The speed of the simulation will depend on the Time Interval that you define to run the script (with a minimum interval of 30 seconds). It is an automated way to simulate a real device.

## How to run the script
* Create a Google Spreadsheet by following this template: [Training Spreadsheet](https://docs.google.com/spreadsheets/d/1MF5xih03tlFQzZD7fBbFS8miLiOK-d-5o_8PqT3oEH8/edit?usp=sharing).<br>
* The variables to be inserted should be located in the first row of the spreadsheet. Values should be included in the cells below in the same column. The variable names should not contain **comma** or **spaces**; also the values should not contain **comma**;<br>
* Make sure that your spreadsheet is set for Public Visualization so that Tago is able to access it. To do this, click in **Share** > **Advanced** > **Change (Anyone who has the link can view)** > Select **ON - Anyone with the link** > **Can view or Can Edit**.<br>

* Create a new Analysis in the Tago admin website, click on the tab **Examples** and take download of the Scheduler. <br>
![alt text](https://github.com/tago-io/analysis-scheduler/blob/master/_static/analysis_examples.png?raw=true "Analysis examples")<br>

* Go back to the "General information" tab and configure your analysis. <br>
![alt text](https://github.com/tago-io/analysis-scheduler/blob/master/_static/conf_analysis.png?raw=true "Analysis settings")
 1. Put a name for your analysis;
 2. Put 'Timer disabled' here until it verifies that everything is working, after that you can put a desired time to run your simulation;
 3. Let's run in **Tago**; 
 4. Upload the file `scheduler.js.tago.js` file you downloaded in the examples tab;
 5. Script language used for this script, select **Node**;
 6. Click on **Save** button. <br>

* Create a new device: **Device** > **+** > **Put the name for your device** > **Save**. <br>
* Get a token from the device that will receive the simulated data. **Select the device you just created** > **Tokens** > **Copy a token**. <br>

* Go back to analysis you just created. <br>
* Click on the tab **Environment Variables** and create new variables: <br>
1. Put the "*key*" with the name **device_token** and at "*value*" paste the **token of your device**;
2. Put the "*key*" "url" with the name **url**, and at "*value*" paste the **URL from your Google Spreadsheet**; <br>
3. Click on **Save** button.

* I'ts variables should be according to the image: <br> 
![alt text](https://github.com/tago-io/analysis-scheduler/blob/master/_static/env_vars.png?raw=true "Analysis environment variables")

## Check if it is Running
* Go to the Analysis, in the Tago admin, and select your analysis.<br>
* Click on the tab **Console**.<br>
* Click on **Run Script**.<br>
* Check the Console to see if there is any error or if it is running successful.<br>
* If everything is normal, go to **Time interval to run this script** and put to run in the time that you want.<br>

## Google Spreadsheet and private properties
You can input some reserved variables in your spreadsheet, that will not be write into your bucket. These variables can trigger special conditions when the script get's to that line, such as to send email or add color propertie to the variables written at that moment.
The reserved variables are:
* **time**: Will become a propertie of all variables generated by the spreadsheet. It defines a time for the variable to be added; the time can be in the future or in the past. Make sure to use the format *"MM/DD/YYYY HH:mm"*;
* **email**: Send an e-mail to the address. Use with email_msg to personalize the message.
* **email_msg**: Body of the message to be sent. Use it with email.

## Metadata 
Used by some widgets to display points, messages, colors, and icons. Here is the list of fields that are used by Tago widgets.
* **x**: Used for Layers X coordinate;
* **y**: Used for Layers Y coordinate;
* **icon**: Used for ImakeMarker to put icons;
* **intensity**: Used for HeatMap to points intensity; 
* **color**: Used for Tables and Layers to display colors.

For more details about metadata, visit the documentation: 
* **Layers**: https://tago.elevio.help/en/articles/28-layer
* **Tables**: https://tago.elevio.help/en/articles/22-table

To use in the spreadsheet, see below:
* Example 1: On the first row put metadata.color -> The **color** property will be sent to all the variables.
* Example 2: On the first row put your_variable_name.metadata.color -> The **color** will be sent only to the variable that was requested.


## Unit

Unit is used to show different types of symbols that represent the unit of the variable.

To use in the spreadsheet, see below:
* Example: On the first row put unit.your_variable_name -> The unit will be sent only to the variable.  